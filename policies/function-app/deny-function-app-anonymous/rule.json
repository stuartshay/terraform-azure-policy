{
  "name": "deny-function-app-anonymous",
  "properties": {
    "description": "This policy denies by default (or audits, if configured) Azure Function Apps that do not have authentication enabled. Function Apps should require authentication to ensure security and protect sensitive code and data. This policy checks the authentication configuration (siteAuthEnabled) on the Function App's config resource. The effect can be set to 'Deny' or 'Disabled' via the policy parameter.",
    "displayName": "Deny or Audit Function App Anonymous Access",
    "metadata": {
      "category": "Function App",
      "source": "Azure Policy Testing Project",
      "version": "2.0.0"
    },
    "mode": "Indexed",
    "parameters": {
      "effect": {
        "allowedValues": [
          "Deny",
          "Disabled"
        ],
        "defaultValue": "Deny",
        "metadata": {
          "description": "Enable or disable the execution of the policy",
          "displayName": "Effect"
        },
        "type": "String"
      }
    },
    "policyRule": {
      "if": {
        "allOf": [
          {
            "equals": "Microsoft.Web/sites",
            "field": "type"
          },
          {
            "contains": "functionapp",
            "field": "kind"
          },
          {
            "field": "kind",
            "notContains": "workflowapp"
          },
          {
            "field": "Microsoft.Web/sites/siteConfig.authSettings.enabled",
            "notEquals": "true"
          }
        ]
      },
      "then": {
        "effect": "[parameters('effect')]"
      }
    },
    "policyType": "Custom"
  }
}
